<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Jerimum</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-box { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .admin-input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
        .btn-save { background: #2E7D32; color: white; border: none; padding: 12px; cursor: pointer; width: 100%; border-radius: 6px; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-save:hover { background: #1b5e20; }
        .btn-add { background: #E67E22; color: white; border: none; padding: 12px; cursor: pointer; width: 100%; border-radius: 6px; font-weight: bold; }
        .item-list { list-style: none; padding: 0; }
        .item-list li { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; background: #fff; }
        .btn-del { color: #d32f2f; cursor: pointer; border: 1px solid #d32f2f; background: none; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        .categoria-label { background: #333; color: #fff; padding: 5px 10px; font-weight: bold; font-size: 13px; margin-top: 15px; border-radius: 4px; display: block; }
        hr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }
    </style>
</head>
<body style="background: #f4f4f4;">

    <header class="header-sticky">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
            <h1 class="brand">Painel Admin</h1>
            <a href="index.html" style="color: white; text-decoration: none; font-size: 14px; font-weight: bold;">← Ver Cardápio</a>
        </div>
    </header>

    <main class="container">
        <div class="admin-box">
            <h3>Configurações Gerais</h3>
            <label>Marmita Pequena (R$)</label> 
            <input type="number" id="precoP" class="admin-input" step="0.01">
            
            <label>Marmita Grande (R$)</label> 
            <input type="number" id="precoG" class="admin-input" step="0.01">
            
            <label>Carne Extra (R$)</label> 
            <input type="number" id="precoExtra" class="admin-input" step="0.01">
            
            <hr>
            
            <label>Abre às (Hora ex: 10)</label> 
            <input type="number" id="horaAbre" class="admin-input">
            
            <label>Fecha às (Hora ex: 14)</label> 
            <input type="number" id="horaFecha" class="admin-input">
            
            <button class="btn-save" onclick="salvarGeral()">Salvar Configurações</button>
        </div>

        <div class="admin-box">
            <h3>Adicionar Novo Item</h3>
            <select id="tipoItem" class="admin-input">
                <option value="acompanhamentos">Acompanhamento</option>
                <option value="carnes">Carne</option>
                <option value="saladas">Salada</option>
            </select>
            <input type="text" id="nomeItem" class="admin-input" placeholder="Nome do item (Ex: Carne de Sol)">
            <input type="number" id="adicionalItem" class="admin-input" placeholder="Acréscimo R$ (Se não houver, deixe 0)" step="0.01" value="0">
            <button class="btn-add" onclick="adicionarItem()">Adicionar ao Cardápio</button>
        </div>

        <div class="admin-box">
            <h3>Itens no Cardápio</h3>
            <div id="lista-itens-admin">
                </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        // Verifica se o usuário passou pelo login
if (sessionStorage.getItem('logado') !== 'true') {
    alert("Você precisa fazer login primeiro!");
    window.location.href = 'index.html'; // Manda de volta para o site
}
        // Função para garantir que os campos reflitam o que está salvo
        function carregarDadosAdmin() {
            // Tenta ler do LocalStorage primeiro
            const dadosSalvos = localStorage.getItem('jerimumConfig');
            if (dadosSalvos) {
                cardapioConfig = JSON.parse(dadosSalvos);
            }

            // Preenche os campos com segurança (usando Number para evitar erros)
            document.getElementById('precoP').value = cardapioConfig.precos.Pequena;
            document.getElementById('precoG').value = cardapioConfig.precos.Grande;
            document.getElementById('precoExtra').value = cardapioConfig.precos.Extra;
            document.getElementById('horaAbre').value = cardapioConfig.horarios.abre;
            document.getElementById('horaFecha').value = cardapioConfig.horarios.fecha;

            renderizarListaAdmin();
        }

function salvarGeral() {
    // 1. Captura os valores dos inputs e garante que são números
    const novosPrecos = {
        Pequena: Number(document.getElementById('precoP').value) || 0,
        Grande: Number(document.getElementById('precoG').value) || 0,
        Extra: Number(document.getElementById('precoExtra').value) || 0
    };

    const novosHorarios = {
        abre: Number(document.getElementById('horaAbre').value) || 10,
        fecha: Number(document.getElementById('horaFecha').value) || 14
    };

    // 2. Atualiza a variável global
    cardapioConfig.precos = novosPrecos;
    cardapioConfig.horarios = novosHorarios;

    // 3. O SEGREDO: Limpa o que existia antes para não dar conflito
    localStorage.removeItem('jerimumConfig'); 
    
    // 4. Salva a nova configuração zerada
    localStorage.setItem('jerimumConfig', JSON.stringify(cardapioConfig));

    alert("✅ Alterações salvas com sucesso! O site agora vai mostrar os novos valores.");
    
    // Recarrega a página para confirmar que os dados "grudaram"
    location.reload();
}

        function adicionarItem() {
            const tipo = document.getElementById('tipoItem').value;
            const nome = document.getElementById('nomeItem').value;
            const adicional = Number(document.getElementById('adicionalItem').value) || 0;

            if(!nome) return alert("Por favor, digite o nome do item!");

            cardapioConfig.itens[tipo].push({ nome: nome, adicional: adicional });
            localStorage.setItem('jerimumConfig', JSON.stringify(cardapioConfig));
            
            document.getElementById('nomeItem').value = '';
            document.getElementById('adicionalItem').value = '0';
            renderizarListaAdmin();
        }

        function removerItem(tipo, index) {
            if(confirm("Deseja mesmo remover este item do cardápio?")) {
                cardapioConfig.itens[tipo].splice(index, 1);
                localStorage.setItem('jerimumConfig', JSON.stringify(cardapioConfig));
                renderizarListaAdmin();
            }
        }

        function renderizarListaAdmin() {
            const container = document.getElementById('lista-itens-admin');
            container.innerHTML = '';

            for (let categoria in cardapioConfig.itens) {
                const label = document.createElement('span');
                label.className = 'categoria-label';
                label.innerText = categoria.toUpperCase();
                container.appendChild(label);

                const ul = document.createElement('ul');
                ul.className = 'item-list';

                cardapioConfig.itens[categoria].forEach((item, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>${item.nome} <strong>(+ R$ ${Number(item.adicional).toFixed(2)})</strong></span>
                        <button class="btn-del" onclick="removerItem('${categoria}', ${index})">Remover</button>
                    `;
                    ul.appendChild(li);
                });
                container.appendChild(ul);
            }
        }

        // Garante que o script.js carregou a variável global antes de preencher
        window.addEventListener('load', carregarDadosAdmin);
    </script>
    
</body>
</html>